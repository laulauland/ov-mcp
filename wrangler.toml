name = "ov-mcp"
main = "packages/cloudflare-worker/src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# KV Namespaces for caching GTFS data
[[kv_namespaces]]
binding = "GTFS_CACHE"
id = "f1f8a39a19554b9fa733b48a1cb136c9"

# Cloudflare Containers for GTFS processing
[[services]]
binding = "GTFS_PROCESSOR"
service = "gtfs-processor-bun"

# Container configuration
[container]
name = "gtfs-processor-bun"
image = "oven/bun:latest"
command = ["bun", "run", "process-gtfs.ts"]

# Environment variables
[vars]
ENVIRONMENT = "production"
GTFS_FEED_URL = "http://gtfs.ovapi.nl/gtfs-nl.zip"
REALTIME_FEED_URL = "http://gtfs.ovapi.nl/gtfsrt"

# Scheduled triggers for automatic GTFS updates
[triggers]
crons = ["0 3 * * SUN"]  # Every Sunday at 3am UTC

# Observability
[observability]
enabled = true

# Migration v1: Original creation of OVMcpAgent (already applied)
[[migrations]]
tag = "v1"
new_classes = ["OVMcpAgent"]

# Migration v2: Delete OVMcpAgent since we now use createMcpHandler
[[migrations]]
tag = "v2"
deleted_classes = ["OVMcpAgent"]
